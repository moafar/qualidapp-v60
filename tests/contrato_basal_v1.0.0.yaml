contract_version: 1.0.0
history:
  - version: 1.0.0
    date: 2025-12-24T00:00:00.000Z
    author: Observatorio + Marisela
    description: Versión inicial en producción del contrato de datos para el dataset de estudios basales de polisomnografía.
  - version: 0.9.0
    date: 2025-12-22T00:00:00.000Z
    author: Observatorio
    description: Contrato alineado con columnas reales extraidas con version 3.3.0 del extractor basal. Se ajustaron rangos/unidades según valores observados en la muestra.
dataset:
  id: stg_clisueno_basal
  title: Datos de Estudio de Polisomnografía Basal
  description: Conjunto de datos que contiene las métricas y resultados de polisomnografía basal para pacientes, incluyendo datos demográficos y métricas de sueño.
  owner: Clínica de Sueño
  domain: Clínica de sueño
  tags:
    - polisomnografia
    - basal
  source_file: muestra_basal_v330.xlsx
schema_policy:
  mode: permissive
  on_extra_columns: warn
  on_missing_columns: fail
rule_catalog:
  - id: required
    description: El campo no puede ser nulo.
  - id: unique
    description: Todos los valores en el campo deben ser únicos.
  - id: range
    description: El valor debe estar dentro de un rango numérico.
  - id: date-range
    description: Validación de límite superior e inferior de fechas.
  - id: domain
    description: El valor debe estar dentro de una lista de valores permitidos.
  - id: regex
    description: El valor debe cumplir con un patrón regex.
columns:
  - name: pte_nombre
    expected_type: text
    criticality: high
    description: Nombre completo del paciente.
    normalization:
      - trim
      - uppercase
    rules:
      - id: required
    sensitivity: pii
  - name: pte_id
    expected_type: identifier
    criticality: high
    description: Identificación única del paciente.
    normalization:
      - trim
    rules:
      - id: required
    sensitivity: pii
  - name: pte_imc
    expected_type: numeric
    criticality: medium
    description: Índice de masa corporal (kg/m^2).
    rules:
      - id: required
      - id: range
        min: 8
        max: 80
  - name: pte_anos_decimales
    expected_type: numeric
    criticality: medium
    description: Edad del paciente en años (puede incluir decimales).
    rules:
      - id: required
      - id: range
        min: 0
        max: 100
  - name: pte_peso_kg
    expected_type: numeric
    criticality: medium
    description: Peso del paciente en kilogramos.
    rules:
      - id: required
      - id: range
        min: 2
        max: 200
  - name: pte_talla_cm
    expected_type: numeric
    criticality: medium
    description: Talla del paciente en centímetros.
    rules:
      - id: required
      - id: range
        min: 40
        max: 200
  - name: pte_cuello_cm
    expected_type: numeric
    criticality: medium
    description: Circunferencia de cuello del paciente en centímetros.
    rules:
      - id: range
        min: 10
        max: 60
  - name: pte_perimetro_abdominal_cm
    expected_type: numeric
    criticality: medium
    description: Perímetro abdominal del paciente en centímetros.
    rules:
      - id: range
        min: 20
        max: 200
  - name: basal_solicita
    expected_type: text
    criticality: medium
    description: Profesional o servicio que solicita el estudio.
    normalization:
      - trim
    rules: null
  - name: basal_empresa
    expected_type: categorical
    criticality: medium
    description: Asegurador/empresa asociada al estudio (origen administrativo).
    normalization:
      - trim
    rules:
      - id: required
    sensitivity: quasi_identifier
  - name: basal_fecha_estudio
    expected_type: datetime
    criticality: high
    description: Fecha (y opcionalmente hora) de realización del estudio.
    rules:
      - id: required
      - id: date-range
        min: 01/12/2024
        max: 31/12/2025
        format: DD/MM/YYYY
        severity: hard
  - name: basal_epworth
    expected_type: numeric
    criticality: medium
    description: Puntaje de la escala de somnolencia de Epworth (0-24).
    rules:
      - id: range
        min: 0
        max: 24
  - name: basal_tiempo_en_cama
    expected_type: numeric
    criticality: high
    description: Tiempo total en cama (minutos).
    rules:
      - id: required
      - id: range
        min: 0
        max: 1440
  - name: basal_tiempo_sueno
    expected_type: numeric
    criticality: high
    description: Tiempo total de sueño (minutos).
    rules:
      - id: required
      - id: range
        min: 0
        max: 1000
  - name: basal_eficiencia_sueno
    expected_type: numeric
    criticality: high
    description: 'Eficiencia del sueño: tiempo de sueño / tiempo en cama (proporción 0-1).'
    rules:
      - id: required
      - id: range
        min: 0.1
        max: 1
  - name: basal_latencia_sueno_total
    expected_type: numeric
    criticality: medium
    description: Latencia de sueño total (minutos) desde el inicio del registro hasta el inicio de sueño.
    rules:
      - id: range
        min: 0
        max: 300
  - name: basal_latencia_sueno_rem
    expected_type: numeric
    criticality: medium
    description: Latencia a sueño REM (minutos) desde el inicio del sueño hasta el primer episodio REM.
    rules:
      - id: range
        min: 0
        max: 600
  - name: basal_indice_microalertamientos
    expected_type: numeric
    criticality: medium
    description: Índice de microalertamientos (eventos por hora).
    rules:
      - id: range
        min: 0
        max: 150
  - name: basal_porcentaje_sueno_rem
    expected_type: numeric
    criticality: medium
    description: Proporción del tiempo total de sueño en fase REM (0-1).
    rules:
      - id: range
        min: 0
        max: 1
  - name: basal_porcentaje_sueno_profundo
    expected_type: numeric
    criticality: medium
    description: Proporción del tiempo total de sueño en sueño profundo (N3) (0-1).
    rules:
      - id: range
        min: 0
        max: 1
  - name: basal_iac
    expected_type: numeric
    criticality: medium
    description: Índice de apneas centrales (eventos por hora).
    rules:
      - id: range
        min: 0
        max: 120
  - name: basal_iao
    expected_type: numeric
    criticality: medium
    description: Índice de apneas obstructivas (eventos por hora).
    rules:
      - id: range
        min: 0
        max: 120
  - name: basal_iam
    expected_type: numeric
    criticality: medium
    description: Índice de apneas mixtas (eventos por hora).
    rules:
      - id: range
        min: 0
        max: 120
  - name: basal_ih
    expected_type: numeric
    criticality: medium
    description: Índice de hipopneas (eventos por hora).
    rules:
      - id: range
        min: 0
        max: 200
  - name: basal_iah
    expected_type: numeric
    criticality: high
    description: Índice de apnea-hipopnea total (eventos por hora).
    rules:
      - id: required
      - id: range
        min: 0
        max: 200
  - name: basal_indice_desat_rem
    expected_type: numeric
    criticality: medium
    description: Índice de desaturaciones en REM (eventos por hora).
    rules:
      - id: range
        min: 0
        max: 600
  - name: basal_indice_desat_nrem
    expected_type: numeric
    criticality: medium
    description: Índice de desaturaciones en NREM (eventos por hora).
    rules:
      - id: range
        min: 0
        max: 1000
  - name: basal_indice_desat_total
    expected_type: numeric
    criticality: medium
    description: Índice total de desaturaciones (eventos por hora).
    rules:
      - id: range
        min: 0
        max: 1600
  - name: basal_numero_eventos_ah
    expected_type: numeric
    criticality: medium
    description: Número total de eventos de apnea+hipopnea (conteo absoluto).
    rules:
      - id: range
        min: 0
        max: 1500
  - name: basal_t90
    expected_type: numeric
    criticality: medium
    description: Proporción del tiempo (0-1) con saturación por debajo de 90%.
    rules:
      - id: range
        min: 0
        max: 1
  - name: basal_t80
    expected_type: numeric
    criticality: medium
    description: Proporción del tiempo (0-1) con saturación por debajo de 80%.
    rules:
      - id: range
        min: 0
        max: 1
  - name: basal_t70
    expected_type: numeric
    criticality: medium
    description: Proporción del tiempo (0-1) con saturación por debajo de 70%.
    rules:
      - id: range
        min: 0
        max: 1
  - name: basal_fuente
    expected_type: text
    criticality: low
    description: Ruta o identificador del archivo fuente desde el cual se extrajo el registro.
    normalization:
      - trim
    rules:
      - id: required
  - name: basal_uuid
    expected_type: identifier
    criticality: high
    description: Identificador único del registro (UUID v4).
    rules:
      - id: required
      - id: unique
  - name: basal_version_control
    expected_type: text
    criticality: low
    description: Texto de control de versión / trazabilidad del registro (p.ej., fecha de extracción o notas de edición).
    normalization:
      - trim
    rules:
      - id: required